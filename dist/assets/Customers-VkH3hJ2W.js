import{dg as T,p as S,dh as R,di as J,_ as j,dj as je,dk as xe,dl as K,dm as fe,dn as ye,dp as V,b as y,u as Se,r as i,d as Ce,a as ve,j as e,aa as Ee,f as ke,C as W,M as Ae,e as Me,R as we}from"./index-CJfqVnYz.js";import{S as Re}from"./index-LewEr_lB.js";import{B as X}from"./ButtonLoader-CGKkO_xu.js";import{M as Y}from"./Modal-DD3nNwbh.js";import"./index-ELJsgl2_.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-DOfgebDh.js";const Ne="_customer_wrapper_j0k0w_1",Be="_customer_search_j0k0w_28",$e="_customer_send_btn_j0k0w_64",Le="_customer_content_wrapper_j0k0w_101",Ie="_customer_content_body_j0k0w_112",Te="_customer_pagination_wrapper_j0k0w_214",Oe="_mobile_customer_search_j0k0w_255",Ge="_modal_container_j0k0w_267",Ue="_modal_content_container_j0k0w_334",ze="_barber_send_btn_j0k0w_409",Fe="_customer_content_body_error_j0k0w_443",t={customer_wrapper:Ne,customer_search:Be,customer_send_btn:$e,customer_content_wrapper:Le,customer_content_body:Ie,customer_pagination_wrapper:Te,mobile_customer_search:Oe,modal_container:Ge,modal_content_container:Ue,barber_send_btn:ze,customer_content_body_error:Fe},De=(h,n,c)=>async m=>{var p,u,b,o;try{m({type:T});const{data:a}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${h}&isApproved=${n}`,{signal:c});m({type:R,payload:a})}catch(a){if(((p=a==null?void 0:a.response)==null?void 0:p.status)===500){m({type:J,payload:"Something went wrong !"}),j.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}a.name!=="CanceledError"&&(m({type:J,payload:(u=a==null?void 0:a.response)==null?void 0:u.data}),j.error((o=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:o.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}))}},He=(h,n,c,m)=>async p=>{var u,b,o,a;try{p({type:je});const{data:d}=await S.post("/api/bulkMessageAndEmails/sendBulkEmails",h);p({type:xe,payload:d}),n(""),c(""),j.success(d==null?void 0:d.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),m(!1)}catch(d){if(((u=d==null?void 0:d.response)==null?void 0:u.status)===500){p({type:K,payload:"Something went wrong !"}),j.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}p({type:K,payload:(b=d==null?void 0:d.response)==null?void 0:b.data}),j.error((a=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},Qe=(h,n,c)=>async m=>{var p,u,b,o;try{m({type:fe});const{data:a}=await S.post("/api/bulkMessageAndEmails/sendBulkTextMessages",h);m({type:ye,payload:a}),n(""),j.success(a==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),c(!1)}catch(a){if(((p=a==null?void 0:a.response)==null?void 0:p.status)===500){m({type:V,payload:"Something went wrong !"}),j.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}m({type:V,payload:(u=a==null?void 0:a.response)==null?void 0:u.data}),j.error((o=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:o.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},Pe=()=>{const h=y(s=>s.BarberLoggedInMiddleware.barberSalonId),n=y(s=>s.BarberLoggedInMiddleware.entiredata),c=Se(),m=i.useRef(new AbortController);i.useEffect(()=>{var r;const s=new AbortController;return m.current=s,c(De(h,(r=n==null?void 0:n.user[0])==null?void 0:r.isApproved,s.signal)),()=>{m.current&&m.current.abort()}},[c,n]);const p=y(s=>s.barberGetAllCustomerList),{loading:u,resolve:b,getAllCustomers:o,currentPage:a,totalPages:d}=p,g=y(Ce)==="On",[N,Z]=i.useState(""),[P,O]=i.useState(!1),ee=async()=>{var s;O(!0);try{const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${h}&isApproved=${(s=n==null?void 0:n.user[0])==null?void 0:s.isApproved}&name=${N}`);c({type:R,payload:r})}catch(r){console.error("Error searching customers:",r)}finally{O(!1)}};i.useEffect(()=>{const s=setTimeout(()=>{ee()},300);return()=>clearTimeout(s)},[N]);const[C,B]=i.useState(1);i.useEffect(()=>{a&&B(a)},[a]);const[se,x]=i.useState(!1),[G,$]=i.useState({}),[v,E]=i.useState([]),[U,k]=i.useState([]),[L,A]=i.useState([]),ae=async()=>{var s;if(C>1)try{c({type:T});const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${h}&isApproved=${(s=n==null?void 0:n.user[0])==null?void 0:s.isApproved}&page=${C-1}`);c({type:R,payload:r}),B(l=>l-1),x(!1)}catch(r){console.error("Error fetching customers:",r),x(!1)}},te=async()=>{var s;if(C<d)try{c({type:T});const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${h}&isApproved=${(s=n==null?void 0:n.user[0])==null?void 0:s.isApproved}&page=${C+1}`);c({type:R,payload:r}),B(l=>l+1),x(!1)}catch(r){console.error("Error fetching customers:",r),x(!1)}},re=s=>{const r=!G[s._id];$(l=>({...l,[s._id]:r})),r?(E(l=>[...l,s.email]),k(l=>[...l,+`${s==null?void 0:s.mobileCountryCode}${s==null?void 0:s.mobileNumber}`]),A(l=>[...l,s.name]),x(!1)):(E(l=>l.filter(f=>f!==s.email)),k(l=>l.filter(f=>f!==+`${s==null?void 0:s.mobileCountryCode}${s==null?void 0:s.mobileNumber}`)),A(l=>l.filter(f=>f!==s.name)),x(!1))},oe=s=>{x(r=>{if(r)E([]),k([]),A([]),$({});else{const l=o.map(_=>_.email),f=o.map(_=>+`${_==null?void 0:_.mobileCountryCode}${_==null?void 0:_.mobileNumber}`),be=o.map(_=>_.name),he=o.reduce((_,ge)=>(_[ge._id]=!0,_),{});E(l),k(f),A(be),$(he)}return!r})};ve();const[ne,M]=i.useState(!1),le=()=>{v.length>0?M(!0):j.error("Atleast one customer needed",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[z,F]=i.useState(""),[D,I]=i.useState(""),de=()=>{c(He({subject:z,message:D,role:"Barber",recipientEmails:v},F,I,M))},ie=y(s=>s.barberSendCustomerEmail),{loading:H}=ie,[ce,w]=i.useState(!1),[Q,me]=i.useState(""),ue=()=>{U.length>0?w(!0):j.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},_e=()=>{c(Qe({smsBody:Q,numbers:U},I,w))},pe=y(s=>s.barberSendCustomerMessage),{loading:q}=pe;return e.jsxs("div",{className:`${t.customer_wrapper} ${g&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${g&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:N,onChange:s=>Z(s.target.value)}),e.jsx("div",{children:e.jsx(Ee,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${g&&t.dark}`,onClick:le,title:"Email",children:e.jsx("div",{children:e.jsx(ke,{})})}),e.jsx(Y,{open:ne,onClose:()=>M(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>M(!1),children:e.jsx(W,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:v==null?void 0:v.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:z,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:D,onChange:s=>I(s.target.value)})]}),H?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(X,{})}):e.jsx("button",{onClick:de,disabled:H,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${g&&t.dark}`,onClick:ue,title:"Message",children:e.jsx("div",{children:e.jsx(Ae,{})})}),e.jsx(Y,{open:ce,onClose:()=>w(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>w(!1),children:e.jsx(W,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:L==null?void 0:L.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:Q,onChange:s=>me(s.target.value)})]}),q?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(X,{})}):e.jsx("button",{onClick:_e,disabled:q,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${g&&t.dark}`,children:u||P?e.jsx("div",{className:t.customer_content_body,children:e.jsx(Re,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:g?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:g?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"})}):!u&&b&&(o==null?void 0:o.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${g&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:oe,checked:se})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),o.map((s,r)=>e.jsxs("div",{style:{borderBottom:o.length-1===r&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:G[s._id]||!1,onChange:()=>re(s)})}),e.jsx("p",{children:(s==null?void 0:s.name.length)>18?`${s.name.slice(0,18)}...`:s.name}),e.jsx("p",{children:(s==null?void 0:s.email.length)>18?`${s.email.slice(0,18)}...`:s.email}),e.jsx("p",{children:s==null?void 0:s.gender}),e.jsx("p",{children:s==null?void 0:s.mobileNumber})]},s._id))]}):!u&&b&&(o==null?void 0:o.length)===0?e.jsx("div",{className:`${t.customer_content_body_error} ${g&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})}):!u&&!b&&e.jsx("div",{className:`${t.customer_content_body_error} ${g&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:t.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:ae,children:e.jsx(Me,{})}),e.jsx("div",{onClick:te,disabled:C===d,children:e.jsx(we,{})})]})})]})};export{Pe as default};
