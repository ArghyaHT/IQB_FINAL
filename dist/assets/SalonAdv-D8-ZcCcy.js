import{b as k,r as l,u as q,d as Q,g as X,h as R,j as e,F as Y,U as ee,D as te,i as ae,S as ne,k as oe,Z as se,l as re,m as le,n as de,o as ie,_ as v,p as N,s as ce,K as ue,T as me,P as fe}from"./index-da8jmMMn.js";import{g as pe,c as he}from"./DashboardAction-CkMv98cu.js";import{B as ge}from"./ButtonLoader-Bbh1qCa_.js";import{S as U}from"./index-Jyq4M2b-.js";const ve="_salonadv_container_17t2k_1",_e="_salonadv_header_17t2k_14",be="_salonadv_adv_list_container_17t2k_145",xe="_salonadv_column_17t2k_150",ye="_salonadv_task_17t2k_187",je="_salonadv_column_error_17t2k_320",r={salonadv_container:ve,salonadv_header:_e,salonadv_adv_list_container:be,salonadv_column:xe,salonadv_task:ye,salonadv_column_error:je},De=()=>{const u=k(t=>t.AdminLoggedInMiddleware.entiredata.user[0]),m=k(t=>t.AdminLoggedInMiddleware.adminSalonId),y=l.useRef(null),w=()=>{y.current.click()},[p,_]=l.useState([]),I=async t=>{const a=t.target.files,d=["image/jpeg","image/webp","image/png"];if(Array.from(a).filter(n=>!d.includes(n.type)).length>0){v.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([]);return}const s=Array.from(a).filter(n=>d.includes(n.type));_(s)},i=q(),j=l.useRef(new AbortController);l.useEffect(()=>{const t=new AbortController;return j.current=t,i(pe(m,t.signal)),()=>{j.current&&j.current.abort()}},[m,i]);const E=k(t=>t.getAllAdvertisement),{loading:b,resolve:x,advertisements:o}=E,[S,A]=l.useState(!1),f=async()=>{var t,a,d,h;if(p.length>0){const s=new FormData;s.append("salonId",m);for(const n of p)s.append("advertisements",n);try{A(!0);const n=await N.post("/api/advertisement/addAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});A(!1),_([]),i({type:"ADD_ADVETISEMENT",payload:(t=n==null?void 0:n.data)==null?void 0:t.response})}catch(n){if(((a=n==null?void 0:n.response)==null?void 0:a.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}A(!1),v.error((h=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:h.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([])}}},[B,F]=l.useState(""),[P,L]=l.useState(""),z=l.useRef(null),[V,D]=l.useState(null),H=(t,a)=>{z.current.click(),F(t),L(a)},K=async t=>{var n,$,M,G;const a=t.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(a.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const h=2*1024*1024;if(a.size>h){v.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const s=new FormData;s.append("id",P),s.append("advertisements",a),s.append("public_imgid",B),s.append("salonId",m);try{D(P);const c=await N.put("/api/advertisement/updateAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});F(""),L(""),D(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(n=c==null?void 0:c.data)==null?void 0:n.response})}catch(c){if((($=c==null?void 0:c.response)==null?void 0:$.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}D(null),v.error((G=(M=c==null?void 0:c.response)==null?void 0:M.data)==null?void 0:G.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[J,C]=l.useState(!1),O=async(t,a)=>{var h;if(window.confirm("Are you sure ?"))try{C(!0),await N.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:t,img_id:a}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:a})}catch(s){if(((h=s==null?void 0:s.response)==null?void 0:h.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},g=k(Q)==="On",W=t=>{const{active:a,over:d}=t;!d||a.id===d.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:a,over:d}})},T=l.useRef(new AbortController);l.useEffect(()=>{if(m&&o&&(o==null?void 0:o.length)>0){const t=new AbortController;return T.current=t,i(he(m,o,t.signal)),()=>{T.current&&T.current.abort()}}},[o,m,i]);const Z=X(R(fe),R(me),R(ue,{coordinateGetter:ce}));return e.jsxs("div",{className:r.salonadv_container,children:[e.jsxs("div",{className:`${r.salonadv_header} ${g&&r.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w(),children:[e.jsx("div",{children:e.jsx(Y,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:y,style:{display:"none"},multiple:!0,onChange:I})]}),e.jsxs("p",{children:[p==null?void 0:p.length," ","Files"]})]}),S?e.jsx("button",{children:e.jsx(ge,{color:"#fff"})}):e.jsxs("button",{onClick:f,disabled:!!S,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(ee,{})})]})]})]}),e.jsx("div",{className:r.salonadv_list_container,children:b&&!x?e.jsx("div",{className:r.salonadv_column,children:[...Array(6)].map((t,a)=>e.jsx(U,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:g?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:g?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"},a))}):!b&&x&&(o==null?void 0:o.length)>0?e.jsx(te,{collisionDetection:ae,onDragEnd:W,sensors:Z,children:e.jsx("div",{className:`${r.salonadv_column} ${g&&r.dark}`,children:e.jsx(ne,{items:o.map(t=>t._id),strategy:oe,children:o.map(t=>e.jsx(se.Fragment,{children:e.jsx(Ae,{id:t._id,url:t.url,public_id:t.public_id,editImageHandler:H,handleEditLoader:V,deleteHandler:O,deleteLoader:J,fileEditInputRef:z,handleEditFileInputChange:K,darkmodeOn:g})},t._id))})})}):!b&&x&&(o==null?void 0:o.length)==0?e.jsx("div",{className:`${r.salonadv_column_error} ${g&&r.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})}):!b&&!x&&e.jsx("div",{className:`${r.salonadv_column_error} ${g&&r.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},Ae=({id:u,url:m,public_id:y,editImageHandler:w,handleEditLoader:p,deleteHandler:_,deleteLoader:I,fileEditInputRef:i,handleEditFileInputChange:j,darkmodeOn:E})=>{const{attributes:b,listeners:x,setNodeRef:o,transform:S,transition:A}=re({id:u});return e.jsxs("div",{className:`${r.salonadv_task} ${E&&r.dark}`,ref:o,...b,...x,style:{transition:A,transform:le.Transform.toString(S)},children:[p===u?e.jsx("div",{children:e.jsx(U,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:m,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w(y,u),disabled:p===u,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:i,style:{display:"none"},onChange:j})]}),e.jsxs("button",{onClick:()=>_(y,u),disabled:I,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(ie,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{De as default};
