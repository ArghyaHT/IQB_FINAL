import{a7 as I,p as E,a8 as M,a9 as Q,_ as N,b as x,u as pe,r as a,d as be,j as e,aa as xe,f as ge,C as J,M as je,e as fe,R as Ce}from"./index-CJfqVnYz.js";import{S as ye}from"./index-LewEr_lB.js";import{d as ve,e as Se}from"./BarberAction-B3CowT8r.js";import{B as K}from"./ButtonLoader-CGKkO_xu.js";import{M as V}from"./Modal-DD3nNwbh.js";import"./index-ELJsgl2_.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-DOfgebDh.js";const ke="_customer_wrapper_14092_1",Ee="_customer_search_14092_28",Me="_customer_send_btn_14092_64",Ne="_customer_content_wrapper_14092_101",$e="_customer_content_body_14092_112",we="_customer_pagination_wrapper_14092_213",Le="_mobile_customer_search_14092_254",Ae="_modal_container_14092_266",Be="_modal_content_container_14092_333",Ie="_barber_send_btn_14092_408",Re="_customer_content_body_error_14092_442",t={customer_wrapper:ke,customer_search:Ee,customer_send_btn:Me,customer_content_wrapper:Ne,customer_content_body:$e,customer_pagination_wrapper:we,mobile_customer_search:Le,modal_container:Ae,modal_content_container:Be,barber_send_btn:Ie,customer_content_body_error:Re},Te=(h,l)=>async m=>{var g,j,f,o;try{m({type:I});const{data:r}=await E.get(`/api/customers/getAllCustomers?salonId=${h}`,{signal:l});m({type:M,payload:r})}catch(r){if(((g=r==null?void 0:r.response)==null?void 0:g.status)===500){m({type:Q,payload:"Something went wrong !"}),N.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}r.name!=="CanceledError"&&(m({type:Q,payload:(j=r==null?void 0:r.response)==null?void 0:j.data}),N.error((o=(f=r==null?void 0:r.response)==null?void 0:f.data)==null?void 0:o.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}))}},Qe=()=>{const h=x(s=>s.AdminLoggedInMiddleware.adminSalonId),l=pe(),m=a.useRef(new AbortController);a.useEffect(()=>{const s=new AbortController;return m.current=s,l(Te(h,s.signal)),()=>{m.current&&m.current.abort()}},[l]);const g=x(s=>s.adminGetAllCustomerList),{loading:j,resolve:f,getAllCustomers:o,currentPage:r,totalPages:R}=g,i=x(be)==="On",[$,W]=a.useState(""),[X,T]=a.useState(!1),G=async()=>{T(!0);try{const{data:s}=await E.get(`/api/customers/getAllCustomers?salonId=${h}&name=${$}`);l({type:M,payload:s})}catch(s){console.error("Error searching customers:",s)}finally{T(!1)}};a.useEffect(()=>{const s=setTimeout(()=>{G()},300);return()=>clearTimeout(s)},[$]);const[Y,u]=a.useState(!1),[O,w]=a.useState({}),[p,C]=a.useState([]),[H,y]=a.useState([]),[L,v]=a.useState([]),[b,A]=a.useState(1);a.useEffect(()=>{r&&A(r)},[r]);const Z=async()=>{if(b>1)try{l({type:I});const{data:s}=await E.get(`/api/customers/getAllCustomers?salonId=${h}&page=${b-1}`);l({type:M,payload:s}),u(!1),A(c=>c-1)}catch(s){console.error("Error fetching customers:",s),u(!1)}},ee=async()=>{if(b<R)try{l({type:I});const{data:s}=await E.get(`/api/customers/getAllCustomers?salonId=${h}&page=${b+1}`);l({type:M,payload:s}),A(c=>c+1),u(!1)}catch(s){console.error("Error fetching customers:",s),u(!1)}},se=s=>{const c=!O[s._id];w(n=>({...n,[s._id]:c})),c?(C(n=>[...n,s.email]),y(n=>[...n,+`${s.mobileCountryCode}${s.mobileNumber}`]),v(n=>[...n,s.name]),u(!1)):(C(n=>n.filter(_=>_!==s.email)),y(n=>n.filter(_=>_!==+`${s.mobileCountryCode}${s.mobileNumber}`)),v(n=>n.filter(_=>_!==s.name)),u(!1))},te=s=>{u(c=>{if(c)C([]),y([]),v([]),w({});else{const n=o.map(d=>d.email),_=o.map(d=>+`${d.mobileCountryCode}${d.mobileNumber}`),ue=o.map(d=>d.name),_e=o.reduce((d,he)=>(d[he._id]=!0,d),{});C(n),y(_),v(ue),w(_e)}return!c})},[ae,S]=a.useState(!1),re=()=>{p.length>0?S(!0):N.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[P,z]=a.useState(""),[U,B]=a.useState(""),ne=()=>{l(ve({subject:P,message:U,role:"Barber",recipientEmails:p},z,B,S))},oe=x(s=>s.adminSendBarberEmail),{loading:F}=oe,[le,k]=a.useState(!1),[q,ce]=a.useState(""),ie=()=>{H.length>0?k(!0):N.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},de=()=>{l(Se({smsBody:q,numbers:H},B,k))},me=x(s=>s.adminSendBarberMessage),{loading:D}=me;return e.jsxs("div",{className:`${t.customer_wrapper} ${i&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${i&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:$,onChange:s=>W(s.target.value)}),e.jsx("div",{onClick:G,children:e.jsx(xe,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${i&&t.dark}`,onClick:re,title:"Email",children:e.jsx("div",{children:e.jsx(ge,{})})}),e.jsx(V,{open:ae,onClose:()=>S(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>S(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:p==null?void 0:p.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:P,onChange:s=>z(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:U,onChange:s=>B(s.target.value)})]}),F?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:ne,disabled:F,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${i&&t.dark}`,onClick:ie,title:"Message",children:e.jsx("div",{children:e.jsx(je,{})})}),e.jsx(V,{open:le,onClose:()=>k(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>k(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:L==null?void 0:L.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:q,onChange:s=>ce(s.target.value)})]}),D?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:de,disabled:D,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${i&&t.dark}`,children:j||X?e.jsx("div",{className:t.customer_content_body,children:e.jsx(ye,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:i?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:i?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"})}):f&&(o==null?void 0:o.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${i&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:te,checked:Y})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),o==null?void 0:o.map((s,c)=>e.jsxs("div",{style:{borderBottom:o.length-1===c&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:O[s._id]||!1,onChange:()=>se(s)})}),e.jsx("p",{children:(s==null?void 0:s.name.length)>18?`${s.name.slice(0,18)}...`:s.name}),e.jsx("p",{children:(s==null?void 0:s.email.length)>18?`${s.email.slice(0,18)}...`:s.email}),e.jsx("p",{children:s==null?void 0:s.gender}),e.jsx("p",{children:s==null?void 0:s.mobileNumber})]},s._id))]}):e.jsx("div",{className:`${t.customer_content_body_error} ${i&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:t.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:Z,children:e.jsx(fe,{})}),e.jsx("div",{onClick:ee,disabled:b===R,children:e.jsx(Ce,{})})]})})]})};export{Qe as default};
