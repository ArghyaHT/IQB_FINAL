import{b as S,r as l,u as Z,d as q,g as Q,h as R,j as e,F as X,U as Y,D as ee,i as ae,S as te,k as oe,Z as ne,l as se,m as re,n as le,o as de,_ as v,p as F,s as ie,K as ce,T as ue,P as me}from"./index-DDukCDKF.js";import{g as fe,c as pe}from"./DashboardAction-Be2OwZ08.js";import{B as he}from"./ButtonLoader-BzxIs721.js";import{S as G}from"./index-CuvRRW2h.js";const ve="_salonadv_container_v2a5s_1",ge="_salonadv_header_v2a5s_14",_e="_salonadv_adv_list_container_v2a5s_145",be="_salonadv_column_v2a5s_150",ye="_salonadv_task_v2a5s_187",xe="_salonadv_column_error_v2a5s_320",d={salonadv_container:ve,salonadv_header:ge,salonadv_adv_list_container:_e,salonadv_column:be,salonadv_task:ye,salonadv_column_error:xe},De=()=>{const u=S(a=>a.AdminLoggedInMiddleware.entiredata.user[0]),m=S(a=>a.AdminLoggedInMiddleware.adminSalonId),y=l.useRef(null),A=()=>{y.current.click()},[p,g]=l.useState([]),k=async a=>{const t=a.target.files,s=["image/jpeg","image/webp","image/png"];if(Array.from(t).filter(o=>!s.includes(o.type)).length>0){v.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),g([]);return}const n=Array.from(t).filter(o=>s.includes(o.type));g(n)},i=Z(),x=l.useRef(new AbortController);l.useEffect(()=>{const a=new AbortController;return x.current=a,i(fe(m,a.signal)),()=>{x.current&&x.current.abort()}},[m,i]);const w=S(a=>a.getAllAdvertisement),{loading:I,resolve:D,advertisements:r}=w,[j,_]=l.useState(!1),f=async()=>{var a,t,s,h;if(p.length>0){const n=new FormData;n.append("salonId",m);for(const o of p)n.append("advertisements",o);try{_(!0);const o=await F.post("/api/advertisement/addAdvertisements",n,{headers:{"Content-Type":"multipart/form-data"}});_(!1),g([]),i({type:"ADD_ADVETISEMENT",payload:(a=o==null?void 0:o.data)==null?void 0:a.response}),v.success("Advertisement uploaded successfully",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}catch(o){if(((t=o==null?void 0:o.response)==null?void 0:t.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}_(!1),v.error((h=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:h.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),g([])}}},[U,P]=l.useState(""),[N,L]=l.useState(""),[B,E]=l.useState(null),V=(a,t,s)=>{s.current?s.current.click():console.error("File input ref is null"),P(a),L(t)},H=async a=>{var o,z,M,$;const t=a.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(t.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const h=2*1024*1024;if(t.size>h){v.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const n=new FormData;n.append("id",N),n.append("advertisements",t),n.append("public_imgid",U),n.append("salonId",m);try{E(N);const c=await F.put("/api/advertisement/updateAdvertisements",n,{headers:{"Content-Type":"multipart/form-data"}});P(""),L(""),E(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(o=c==null?void 0:c.data)==null?void 0:o.response})}catch(c){if(((z=c==null?void 0:c.response)==null?void 0:z.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}E(null),v.error(($=(M=c==null?void 0:c.response)==null?void 0:M.data)==null?void 0:$.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[K,C]=l.useState(!1),J=async(a,t)=>{var h;if(window.confirm("Are you sure ?"))try{C(!0),await F.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:a,img_id:t}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:t})}catch(n){if(((h=n==null?void 0:n.response)==null?void 0:h.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},b=S(q)==="On",O=a=>{const{active:t,over:s}=a;!s||t.id===s.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:t,over:s}})},T=l.useRef(new AbortController);l.useEffect(()=>{if(m&&r&&(r==null?void 0:r.length)>0){const a=new AbortController;return T.current=a,i(pe(m,r,a.signal)),()=>{T.current&&T.current.abort()}}},[r,m,i]);const W=Q(R(me),R(ue),R(ce,{coordinateGetter:ie}));return e.jsxs("div",{className:d.salonadv_container,children:[e.jsxs("div",{className:`${d.salonadv_header} ${b&&d.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(),children:[e.jsx("div",{children:e.jsx(X,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:y,style:{display:"none"},multiple:!0,onChange:k,disabled:!!j})]}),e.jsxs("p",{children:[p==null?void 0:p.length," ","Files"]})]}),j?e.jsx("button",{children:e.jsx(he,{color:"#fff"})}):e.jsxs("button",{onClick:f,disabled:!!j,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(Y,{})})]})]})]}),e.jsx("div",{className:d.salonadv_list_container,children:I?e.jsx("div",{className:d.salonadv_column,children:[...Array(6)].map((a,t)=>e.jsx(G,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:b?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:b?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"},t))}):D&&(r==null?void 0:r.length)>0?e.jsx(ee,{collisionDetection:ae,onDragEnd:O,sensors:W,children:e.jsx("div",{className:`${d.salonadv_column} ${b&&d.dark}`,children:e.jsx(te,{items:r.map(a=>a._id),strategy:oe,children:r.map(a=>e.jsx(ne.Fragment,{children:e.jsx(je,{id:a._id,url:a.url,public_id:a.public_id,editImageHandler:V,handleEditLoader:B,deleteHandler:J,deleteLoader:K,handleEditFileInputChange:H,darkmodeOn:b})},a._id))})})}):e.jsx("div",{className:`${d.salonadv_column_error} ${b&&d.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},je=({id:u,url:m,public_id:y,editImageHandler:A,handleEditLoader:p,deleteHandler:g,deleteLoader:k,handleEditFileInputChange:i,darkmodeOn:x})=>{const{attributes:w,listeners:I,setNodeRef:D,transform:r,transition:j}=se({id:u}),_=l.useRef(null);return e.jsxs("div",{className:`${d.salonadv_task} ${x&&d.dark}`,ref:D,...w,...I,style:{transition:j,transform:re.Transform.toString(r)},children:[p===u?e.jsx("div",{children:e.jsx(G,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:m,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(y,u,_),disabled:p===u,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(le,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:_,style:{display:"none"},onChange:i})]}),e.jsxs("button",{onClick:()=>g(y,u),disabled:k,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{De as default};
