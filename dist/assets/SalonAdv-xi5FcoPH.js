import{b as S,r,u as q,d as Q,g as X,h as R,j as e,F as Y,U as ee,D as te,i as ae,S as ne,k as oe,Z as se,l as re,m as le,n as de,o as ie,_ as g,p as F,s as ce,K as ue,T as me,P as fe}from"./index-D1NNQ8TS.js";import{g as pe,c as he}from"./DashboardAction-fMlSZjtm.js";import{B as ge}from"./ButtonLoader-BhpF0-Mh.js";import{S as U}from"./index-BfkzATpX.js";const ve="_salonadv_container_17t2k_1",_e="_salonadv_header_17t2k_14",be="_salonadv_adv_list_container_17t2k_145",xe="_salonadv_column_17t2k_150",ye="_salonadv_task_17t2k_187",je="_salonadv_column_error_17t2k_320",d={salonadv_container:ve,salonadv_header:_e,salonadv_adv_list_container:be,salonadv_column:xe,salonadv_task:ye,salonadv_column_error:je},De=()=>{const u=S(t=>t.AdminLoggedInMiddleware.entiredata.user[0]),m=S(t=>t.AdminLoggedInMiddleware.adminSalonId),b=r.useRef(null),A=()=>{b.current.click()},[p,v]=r.useState([]),k=async t=>{const a=t.target.files,l=["image/jpeg","image/webp","image/png"];if(Array.from(a).filter(n=>!l.includes(n.type)).length>0){g.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),v([]);return}const o=Array.from(a).filter(n=>l.includes(n.type));v(o)},i=q(),x=r.useRef(new AbortController);r.useEffect(()=>{const t=new AbortController;return x.current=t,i(pe(m,t.signal)),()=>{x.current&&x.current.abort()}},[m,i]);const w=S(t=>t.getAllAdvertisement),{loading:I,resolve:E,advertisements:s}=w,[j,y]=r.useState(!1),f=async()=>{var t,a,l,h;if(p.length>0){const o=new FormData;o.append("salonId",m);for(const n of p)o.append("advertisements",n);try{y(!0);const n=await F.post("/api/advertisement/addAdvertisements",o,{headers:{"Content-Type":"multipart/form-data"}});y(!1),v([]),i({type:"ADD_ADVETISEMENT",payload:(t=n==null?void 0:n.data)==null?void 0:t.response})}catch(n){if(((a=n==null?void 0:n.response)==null?void 0:a.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}y(!1),g.error((h=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:h.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),v([])}}},[B,P]=r.useState(""),[N,L]=r.useState(""),z=r.useRef(null),[V,D]=r.useState(null),H=(t,a)=>{z.current.click(),P(t),L(a)},K=async t=>{var n,M,$,G;const a=t.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(a.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const h=2*1024*1024;if(a.size>h){g.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const o=new FormData;o.append("id",N),o.append("advertisements",a),o.append("public_imgid",B),o.append("salonId",m);try{D(N);const c=await F.put("/api/advertisement/updateAdvertisements",o,{headers:{"Content-Type":"multipart/form-data"}});P(""),L(""),D(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(n=c==null?void 0:c.data)==null?void 0:n.response})}catch(c){if(((M=c==null?void 0:c.response)==null?void 0:M.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}D(null),g.error((G=($=c==null?void 0:c.response)==null?void 0:$.data)==null?void 0:G.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[J,C]=r.useState(!1),O=async(t,a)=>{var h;if(window.confirm("Are you sure ?"))try{C(!0),await F.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:t,img_id:a}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:a})}catch(o){if(((h=o==null?void 0:o.response)==null?void 0:h.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},_=S(Q)==="On",W=t=>{const{active:a,over:l}=t;!l||a.id===l.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:a,over:l}})},T=r.useRef(new AbortController);r.useEffect(()=>{if(m&&s&&(s==null?void 0:s.length)>0){const t=new AbortController;return T.current=t,i(he(m,s,t.signal)),()=>{T.current&&T.current.abort()}}},[s,m,i]);const Z=X(R(fe),R(me),R(ue,{coordinateGetter:ce}));return e.jsxs("div",{className:d.salonadv_container,children:[e.jsxs("div",{className:`${d.salonadv_header} ${_&&d.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(),children:[e.jsx("div",{children:e.jsx(Y,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:b,style:{display:"none"},multiple:!0,onChange:k})]}),e.jsxs("p",{children:[p==null?void 0:p.length," ","Files"]})]}),j?e.jsx("button",{children:e.jsx(ge,{color:"#fff"})}):e.jsxs("button",{onClick:f,disabled:!!j,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(ee,{})})]})]})]}),e.jsx("div",{className:d.salonadv_list_container,children:I?e.jsx("div",{className:d.salonadv_column,children:[...Array(6)].map((t,a)=>e.jsx(U,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:_?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:_?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"},a))}):E&&(s==null?void 0:s.length)>0?e.jsx(te,{collisionDetection:ae,onDragEnd:W,sensors:Z,children:e.jsx("div",{className:`${d.salonadv_column} ${_&&d.dark}`,children:e.jsx(ne,{items:s.map(t=>t._id),strategy:oe,children:s.map(t=>e.jsx(se.Fragment,{children:e.jsx(Se,{id:t._id,url:t.url,public_id:t.public_id,editImageHandler:H,handleEditLoader:V,deleteHandler:O,deleteLoader:J,fileEditInputRef:z,handleEditFileInputChange:K,darkmodeOn:_})},t._id))})})}):e.jsx("div",{className:`${d.salonadv_column_error} ${_&&d.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},Se=({id:u,url:m,public_id:b,editImageHandler:A,handleEditLoader:p,deleteHandler:v,deleteLoader:k,fileEditInputRef:i,handleEditFileInputChange:x,darkmodeOn:w})=>{const{attributes:I,listeners:E,setNodeRef:s,transform:j,transition:y}=re({id:u});return e.jsxs("div",{className:`${d.salonadv_task} ${w&&d.dark}`,ref:s,...I,...E,style:{transition:y,transform:le.Transform.toString(j)},children:[p===u?e.jsx("div",{children:e.jsx(U,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:m,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(b,u),disabled:p===u,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:i,style:{display:"none"},onChange:x})]}),e.jsxs("button",{onClick:()=>v(b,u),disabled:k,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(ie,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{De as default};
