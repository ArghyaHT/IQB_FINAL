import{b as S,r,u as q,d as Q,g as X,h as T,j as e,F as Y,U as ee,D as ae,i as te,S as oe,k as ne,Z as se,l as re,m as le,n as de,o as ie,_ as v,p as F,s as ce,K as ue,T as me,P as fe}from"./index-u-AATrzO.js";import{g as pe,c as he}from"./DashboardAction-CmVkMZLB.js";import{B as ve}from"./ButtonLoader-CR5N2D0l.js";import{S as U}from"./index-JU4tkeik.js";const ge="_salonadv_container_v2a5s_1",_e="_salonadv_header_v2a5s_14",be="_salonadv_adv_list_container_v2a5s_145",ye="_salonadv_column_v2a5s_150",xe="_salonadv_task_v2a5s_187",je="_salonadv_column_error_v2a5s_320",d={salonadv_container:ge,salonadv_header:_e,salonadv_adv_list_container:be,salonadv_column:ye,salonadv_task:xe,salonadv_column_error:je},De=()=>{const u=S(a=>a.AdminLoggedInMiddleware.entiredata.user[0]),m=S(a=>a.AdminLoggedInMiddleware.adminSalonId),b=r.useRef(null),A=()=>{b.current.click()},[p,g]=r.useState([]),k=async a=>{const t=a.target.files,l=["image/jpeg","image/webp","image/png"];if(Array.from(t).filter(o=>!l.includes(o.type)).length>0){v.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),g([]);return}const n=Array.from(t).filter(o=>l.includes(o.type));g(n)},i=q(),y=r.useRef(new AbortController);r.useEffect(()=>{const a=new AbortController;return y.current=a,i(pe(m,a.signal)),()=>{y.current&&y.current.abort()}},[m,i]);const w=S(a=>a.getAllAdvertisement),{loading:I,resolve:E,advertisements:s}=w,[x,j]=r.useState(!1),f=async()=>{var a,t,l,h;if(p.length>0){const n=new FormData;n.append("salonId",m);for(const o of p)n.append("advertisements",o);try{j(!0);const o=await F.post("/api/advertisement/addAdvertisements",n,{headers:{"Content-Type":"multipart/form-data"}});j(!1),g([]),i({type:"ADD_ADVETISEMENT",payload:(a=o==null?void 0:o.data)==null?void 0:a.response}),v.success("Advertisement uploaded successfully",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}catch(o){if(((t=o==null?void 0:o.response)==null?void 0:t.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}j(!1),v.error((h=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:h.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),g([])}}},[B,P]=r.useState(""),[N,L]=r.useState(""),z=r.useRef(null),[V,D]=r.useState(null),H=(a,t)=>{z.current.click(),P(a),L(t)},K=async a=>{var o,M,$,G;const t=a.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(t.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const h=2*1024*1024;if(t.size>h){v.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const n=new FormData;n.append("id",N),n.append("advertisements",t),n.append("public_imgid",B),n.append("salonId",m);try{D(N);const c=await F.put("/api/advertisement/updateAdvertisements",n,{headers:{"Content-Type":"multipart/form-data"}});P(""),L(""),D(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(o=c==null?void 0:c.data)==null?void 0:o.response})}catch(c){if(((M=c==null?void 0:c.response)==null?void 0:M.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}D(null),v.error((G=($=c==null?void 0:c.response)==null?void 0:$.data)==null?void 0:G.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[J,C]=r.useState(!1),O=async(a,t)=>{var h;if(window.confirm("Are you sure ?"))try{C(!0),await F.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:a,img_id:t}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:t})}catch(n){if(((h=n==null?void 0:n.response)==null?void 0:h.status)===500){v.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},_=S(Q)==="On",W=a=>{const{active:t,over:l}=a;!l||t.id===l.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:t,over:l}})},R=r.useRef(new AbortController);r.useEffect(()=>{if(m&&s&&(s==null?void 0:s.length)>0){const a=new AbortController;return R.current=a,i(he(m,s,a.signal)),()=>{R.current&&R.current.abort()}}},[s,m,i]);const Z=X(T(fe),T(me),T(ue,{coordinateGetter:ce}));return e.jsxs("div",{className:d.salonadv_container,children:[e.jsxs("div",{className:`${d.salonadv_header} ${_&&d.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(),children:[e.jsx("div",{children:e.jsx(Y,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:b,style:{display:"none"},multiple:!0,onChange:k,disabled:!!x})]}),e.jsxs("p",{children:[p==null?void 0:p.length," ","Files"]})]}),x?e.jsx("button",{children:e.jsx(ve,{color:"#fff"})}):e.jsxs("button",{onClick:f,disabled:!!x,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(ee,{})})]})]})]}),e.jsx("div",{className:d.salonadv_list_container,children:I?e.jsx("div",{className:d.salonadv_column,children:[...Array(6)].map((a,t)=>e.jsx(U,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:_?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:_?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"},t))}):E&&(s==null?void 0:s.length)>0?e.jsx(ae,{collisionDetection:te,onDragEnd:W,sensors:Z,children:e.jsx("div",{className:`${d.salonadv_column} ${_&&d.dark}`,children:e.jsx(oe,{items:s.map(a=>a._id),strategy:ne,children:s.map(a=>e.jsx(se.Fragment,{children:e.jsx(Se,{id:a._id,url:a.url,public_id:a.public_id,editImageHandler:H,handleEditLoader:V,deleteHandler:O,deleteLoader:J,fileEditInputRef:z,handleEditFileInputChange:K,darkmodeOn:_})},a._id))})})}):e.jsx("div",{className:`${d.salonadv_column_error} ${_&&d.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},Se=({id:u,url:m,public_id:b,editImageHandler:A,handleEditLoader:p,deleteHandler:g,deleteLoader:k,fileEditInputRef:i,handleEditFileInputChange:y,darkmodeOn:w})=>{const{attributes:I,listeners:E,setNodeRef:s,transform:x,transition:j}=re({id:u});return e.jsxs("div",{className:`${d.salonadv_task} ${w&&d.dark}`,ref:s,...I,...E,style:{transition:j,transform:le.Transform.toString(x)},children:[p===u?e.jsx("div",{children:e.jsx(U,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:m,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(b,u),disabled:p===u,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:i,style:{display:"none"},onChange:y})]}),e.jsxs("button",{onClick:()=>g(b,u),disabled:k,onPointerDown:f=>f.stopPropagation(),onTouchStart:f=>f.stopPropagation(),children:[e.jsx("div",{children:e.jsx(ie,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{De as default};
