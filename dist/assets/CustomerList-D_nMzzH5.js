import{a4 as B,q as k,a5 as E,a6 as Q,_ as I,b as p,u as pe,r,d as xe,j as e,t as ge,f as je,C as J,M as fe,e as Ce,R as ye}from"./index-LE4wwcdg.js";import{S as ve}from"./index-BAtn3kHc.js";import{d as Se,e as ke}from"./BarberAction-C1pW1p8U.js";import{B as K}from"./ButtonLoader-evyw5ydJ.js";import{M as V}from"./Modal-2aVE2EVH.js";import"./index-C8qIyj46.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-Difek1I8.js";const Ee="_customer_wrapper_1qzm0_1",Me="_customer_search_1qzm0_28",Ne="_customer_send_btn_1qzm0_64",$e="_customer_content_wrapper_1qzm0_101",we="_customer_content_body_1qzm0_112",Le="_customer_pagination_wrapper_1qzm0_217",Ae="_mobile_customer_search_1qzm0_258",Be="_modal_container_1qzm0_270",Ie="_modal_content_container_1qzm0_337",qe="_barber_send_btn_1qzm0_412",ze="_customer_content_body_error_1qzm0_446",t={customer_wrapper:Ee,customer_search:Me,customer_send_btn:Ne,customer_content_wrapper:$e,customer_content_body:we,customer_pagination_wrapper:Le,mobile_customer_search:Ae,modal_container:Be,modal_content_container:Ie,barber_send_btn:qe,customer_content_body_error:ze},Re=(_,h)=>async n=>{var b,j;try{n({type:B});const{data:o}=await k.get(`/api/customers/getAllCustomers?salonId=${_}`,{signal:h});n({type:E,payload:o})}catch(o){if(((b=o==null?void 0:o.response)==null?void 0:b.status)===500){n({type:Q,payload:"Something went wrong !"}),I.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}o.name!=="CanceledError"&&n({type:Q,payload:(j=o==null?void 0:o.response)==null?void 0:j.data})}},Je=()=>{const _=p(s=>s.AdminLoggedInMiddleware.adminSalonId),h=p(s=>s.AdminLoggedInMiddleware.adminSalonId),n=pe(),b=r.useRef(new AbortController);r.useEffect(()=>{const s=new AbortController;return b.current=s,n(Re(h,s.signal)),()=>{b.current&&b.current.abort()}},[n]);const j=p(s=>s.adminGetAllCustomerList),{loading:o,resolve:W,getAllCustomers:l,currentPage:M,totalPages:q}=j,d=p(xe)==="On",[N,X]=r.useState(""),[Y,z]=r.useState(!1),R=async()=>{z(!0);try{const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&name=${N}`);n({type:E,payload:s})}catch(s){console.error("Error searching customers:",s)}finally{z(!1)}};r.useEffect(()=>{const s=setTimeout(()=>{R()},300);return()=>clearTimeout(s)},[N]);const[Z,m]=r.useState(!1),[T,$]=r.useState({}),[x,f]=r.useState([]),[G,C]=r.useState([]),[w,y]=r.useState([]),[g,L]=r.useState(1);r.useEffect(()=>{M&&L(M)},[M]);const ee=async()=>{if(g>1)try{n({type:B});const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${g-1}`);n({type:E,payload:s}),m(!1),L(c=>c-1)}catch(s){console.error("Error fetching customers:",s),m(!1)}},se=async()=>{if(g<q)try{n({type:B});const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${g+1}`);n({type:E,payload:s}),L(c=>c+1),m(!1)}catch(s){console.error("Error fetching customers:",s),m(!1)}},te=s=>{const c=!T[s._id];$(a=>({...a,[s._id]:c})),c?(f(a=>[...a,s.email]),C(a=>[...a,+`${s.mobileCountryCode}${s.mobileNumber}`]),y(a=>[...a,s.name]),m(!1)):(f(a=>a.filter(u=>u!==s.email)),C(a=>a.filter(u=>u!==+`${s.mobileCountryCode}${s.mobileNumber}`)),y(a=>a.filter(u=>u!==s.name)),m(!1))},re=s=>{m(c=>{if(c)f([]),C([]),y([]),$({});else{const a=l.map(i=>i.email),u=l.map(i=>+`${i.mobileCountryCode}${i.mobileNumber}`),_e=l.map(i=>i.name),he=l.reduce((i,be)=>(i[be._id]=!0,i),{});f(a),C(u),y(_e),$(he)}return!c})},[ae,v]=r.useState(!1),ne=()=>{x.length>0?v(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[O,H]=r.useState(""),[P,A]=r.useState(""),oe=()=>{n(Se({subject:O,message:P,role:"Barber",recipientEmails:x},H,A,v))},le=p(s=>s.adminSendBarberEmail),{loading:U}=le,[ce,S]=r.useState(!1),[F,de]=r.useState(""),ie=()=>{G.length>0?S(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},me=()=>{n(ke({smsBody:F,numbers:G},A,S))},ue=p(s=>s.adminSendBarberMessage),{loading:D}=ue;return e.jsxs("div",{className:`${t.customer_wrapper} ${d&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${d&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:N,onChange:s=>X(s.target.value)}),e.jsx("div",{onClick:R,children:e.jsx(ge,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${d&&t.dark}`,onClick:ne,title:"Email",disabled:_===0,style:{cursor:_===0?"not-allowed":"cursor"},children:e.jsx("div",{children:e.jsx(je,{})})}),e.jsx(V,{open:ae,onClose:()=>v(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>v(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:x==null?void 0:x.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:O,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:P,onChange:s=>A(s.target.value)})]}),U?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:oe,disabled:U,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${d&&t.dark}`,onClick:ie,title:"Message",disabled:_===0,style:{cursor:_===0?"not-allowed":"cursor"},children:e.jsx("div",{children:e.jsx(fe,{})})}),e.jsx(V,{open:ce,onClose:()=>S(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>S(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:w==null?void 0:w.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:F,onChange:s=>de(s.target.value)})]}),D?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:me,disabled:D,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${d&&t.dark}`,children:o||Y?e.jsx("div",{className:t.customer_content_body,children:e.jsx(ve,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:d?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:d?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"})}):W&&(l==null?void 0:l.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${d&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:re,checked:Z})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),l==null?void 0:l.map((s,c)=>e.jsxs("div",{style:{borderBottom:l.length-1===c&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:T[s._id]||!1,onChange:()=>te(s)})}),e.jsx("p",{children:(s==null?void 0:s.name.length)>18?`${s.name.slice(0,18)}...`:s.name}),e.jsx("p",{children:(s==null?void 0:s.email.length)>18?`${s.email.slice(0,18)}...`:s.email}),e.jsx("p",{children:s==null?void 0:s.gender}),e.jsx("p",{children:s==null?void 0:s.mobileNumber})]},s._id))]}):e.jsx("div",{className:`${t.customer_content_body_error} ${d&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:t.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:ee,children:e.jsx(Ce,{})}),e.jsx("div",{onClick:se,disabled:g===q,children:e.jsx(ye,{})})]})})]})};export{Je as default};
