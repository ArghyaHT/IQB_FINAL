import{a9 as B,x as k,aa as $,ab as Q,_ as I,u as p,a as pe,r as a,d as ge,j as e,z as xe,h as je,C as J,i as fe,S as Ce,f as ye,R as ve}from"./index-zklAvn-K.js";import{d as Se,e as ke}from"./BarberAction-BTxzqJAm.js";import{B as K}from"./ButtonLoader-DrEEcdA8.js";import{M as V}from"./Modal-KFQkxZ6b.js";import"./index-DikGMDqK.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-C0jiAxVM.js";const $e="_customer_wrapper_egmah_1",Ee="_customer_search_egmah_28",Me="_customer_send_btn_egmah_65",Ne="_customer_content_wrapper_egmah_102",we="_customer_content_body_egmah_113",Le="_customer_pagination_wrapper_egmah_192",Ae="_mobile_customer_search_egmah_233",Be="_modal_container_egmah_245",Ie="_modal_content_container_egmah_312",Re="_barber_send_btn_egmah_356",Te="_customer_content_body_error_egmah_390",Ge="_dark_egmah_404",t={customer_wrapper:$e,customer_search:Ee,customer_send_btn:Me,customer_content_wrapper:Ne,customer_content_body:we,customer_pagination_wrapper:Le,mobile_customer_search:Ae,modal_container:Be,modal_content_container:Ie,barber_send_btn:Re,customer_content_body_error:Te,dark:Ge},Oe=(_,h)=>async n=>{var b,j;try{n({type:B});const{data:l}=await k.get(`/api/customers/getAllCustomers?salonId=${_}`,{signal:h});n({type:$,payload:l})}catch(l){if(((b=l==null?void 0:l.response)==null?void 0:b.status)===500){n({type:Q,payload:"Something went wrong !"}),I.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}l.name!=="CanceledError"&&n({type:Q,payload:(j=l==null?void 0:l.response)==null?void 0:j.data})}},Je=()=>{const _=p(s=>s.AdminLoggedInMiddleware.adminSalonId),h=p(s=>s.AdminLoggedInMiddleware.adminSalonId),n=pe(),b=a.useRef(new AbortController);a.useEffect(()=>{const s=new AbortController;return b.current=s,n(Oe(h,s.signal)),()=>{b.current&&b.current.abort()}},[n]);const j=p(s=>s.adminGetAllCustomerList),{loading:l,resolve:W,getAllCustomers:c,currentPage:E,totalPages:R}=j,o=p(ge)==="On",[M,X]=a.useState(""),[Y,T]=a.useState(!1),G=async()=>{T(!0);try{const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&name=${M}`);n({type:$,payload:s})}catch(s){console.error("Error searching customers:",s)}finally{T(!1)}};a.useEffect(()=>{const s=setTimeout(()=>{G()},300);return()=>clearTimeout(s)},[M]);const[Z,m]=a.useState(!1),[O,N]=a.useState({}),[g,f]=a.useState([]),[z,C]=a.useState([]),[w,y]=a.useState([]),[x,L]=a.useState(1);a.useEffect(()=>{E&&L(E)},[E]);const ee=async()=>{if(x>1)try{n({type:B});const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${x-1}`);n({type:$,payload:s}),m(!1),L(i=>i-1)}catch(s){console.error("Error fetching customers:",s),m(!1)}},se=async()=>{if(x<R)try{n({type:B});const{data:s}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${x+1}`);n({type:$,payload:s}),L(i=>i+1),m(!1)}catch(s){console.error("Error fetching customers:",s),m(!1)}},te=s=>{const i=!O[s._id];N(r=>({...r,[s._id]:i})),i?(f(r=>[...r,s.email]),C(r=>[...r,+`${s.mobileCountryCode}${s.mobileNumber}`]),y(r=>[...r,s.name]),m(!1)):(f(r=>r.filter(u=>u!==s.email)),C(r=>r.filter(u=>u!==+`${s.mobileCountryCode}${s.mobileNumber}`)),y(r=>r.filter(u=>u!==s.name)),m(!1))},ae=s=>{m(i=>{if(i)f([]),C([]),y([]),N({});else{const r=c.map(d=>d.email),u=c.map(d=>+`${d.mobileCountryCode}${d.mobileNumber}`),_e=c.map(d=>d.name),he=c.reduce((d,be)=>(d[be._id]=!0,d),{});f(r),C(u),y(_e),N(he)}return!i})},[re,v]=a.useState(!1),ne=()=>{g.length>0?v(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[H,P]=a.useState(""),[U,A]=a.useState(""),oe=()=>{n(Se({subject:H,message:U,role:"Barber",recipientEmails:g},P,A,v))},le=p(s=>s.adminSendBarberEmail),{loading:F}=le,[ce,S]=a.useState(!1),[q,ie]=a.useState(""),de=()=>{z.length>0?S(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},me=()=>{n(ke({smsBody:q,numbers:z},A,S))},ue=p(s=>s.adminSendBarberMessage),{loading:D}=ue;return e.jsxs("div",{className:`${t.customer_wrapper} ${o&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${o&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:M,onChange:s=>X(s.target.value)}),e.jsx("div",{onClick:G,children:e.jsx(xe,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${o&&t.dark}`,onClick:ne,title:"Email",disabled:_===0,style:{cursor:_===0?"not-allowed":"cursor"},children:e.jsx("div",{children:e.jsx(je,{})})}),e.jsx(V,{open:re,onClose:()=>v(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:`${t.modal_container} ${o&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>v(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:g==null?void 0:g.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:H,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:U,onChange:s=>A(s.target.value)})]}),F?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:oe,disabled:F,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${o&&t.dark}`,onClick:de,title:"Message",disabled:_===0,style:{cursor:_===0?"not-allowed":"cursor"},children:e.jsx("div",{children:e.jsx(fe,{})})}),e.jsx(V,{open:ce,onClose:()=>S(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:`${t.modal_container} ${o&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>S(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:w==null?void 0:w.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:q,onChange:s=>ie(s.target.value)})]}),D?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:me,disabled:D,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${o&&t.dark}`,children:l||Y?e.jsx("div",{className:t.customer_content_body,children:e.jsx(Ce,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:o?"var(--dark-loader-bg-color)":"var(--light-loader-bg-color)",highlightColor:o?"var(--dark-loader-highlight-color)":"var(--light-loader-highlight-color)"})}):W&&(c==null?void 0:c.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${o&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:ae,checked:Z})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),c==null?void 0:c.map((s,i)=>e.jsxs("div",{style:{borderBottom:c.length-1===i&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:O[s._id]||!1,onChange:()=>te(s)})}),e.jsx("p",{children:(s==null?void 0:s.name.length)>18?`${s.name.slice(0,18)}...`:s.name}),e.jsx("p",{children:(s==null?void 0:s.email.length)>18?`${s.email.slice(0,18)}...`:s.email}),e.jsx("p",{children:s==null?void 0:s.gender}),e.jsx("p",{children:s==null?void 0:s.mobileNumber})]},s._id))]}):e.jsx("div",{className:`${t.customer_content_body_error} ${o&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:`${t.customer_pagination_wrapper} ${o&&t.dark}`,children:e.jsxs("div",{children:[e.jsx("div",{onClick:ee,children:e.jsx(ye,{})}),e.jsx("div",{onClick:se,disabled:x===R,children:e.jsx(ve,{})})]})})]})};export{Je as default};
