import{u as S,r as l,a as q,d as Q,i as X,k as T,j as e,F as Y,U as Z,l as ee,m as te,o as ae,p as ne,q as se,s as oe,t as re,v as le,w as de,_ as g,x as z,y as ie,K as ce,T as ue,P as fe}from"./index-DFA1I3My.js";import{g as me,c as pe}from"./DashboardAction-BJ7O9Ho9.js";import{B as ve}from"./ButtonLoader-CqmVXasV.js";import{S as G}from"./index-CdiqSvTI.js";const ge="_salonadv_container_1lfv1_1",he="_salonadv_header_1lfv1_14",_e="_salonadv_adv_list_container_1lfv1_145",be="_salonadv_column_1lfv1_150",ye="_salonadv_task_1lfv1_160",xe="_salonadv_column_error_1lfv1_293",je="_dark_1lfv1_306",d={salonadv_container:ge,salonadv_header:he,salonadv_adv_list_container:_e,salonadv_column:be,salonadv_task:ye,salonadv_column_error:xe,dark:je},De=()=>{const u=S(t=>t.AdminLoggedInMiddleware.entiredata.user[0]),f=S(t=>t.AdminLoggedInMiddleware.adminSalonId),y=l.useRef(null),A=()=>{y.current.click()},[p,_]=l.useState([]),k=async t=>{const a=t.target.files,o=["image/jpeg","image/webp","image/png"];if(Array.from(a).filter(n=>!o.includes(n.type)).length>0){g.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([]);return}const s=Array.from(a).filter(n=>o.includes(n.type));_(s)},i=q(),x=l.useRef(new AbortController);l.useEffect(()=>{const t=new AbortController;return x.current=t,i(me(f,t.signal)),()=>{x.current&&x.current.abort()}},[f,i]);const w=S(t=>t.getAllAdvertisement),{loading:I,resolve:E,advertisements:r}=w,[j,b]=l.useState(!1),m=async()=>{var t,a,o,v;if(p.length>0){const s=new FormData;s.append("salonId",f);for(const n of p)s.append("advertisements",n);try{b(!0);const n=await z.post("/api/advertisement/addAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});b(!1),_([]),i({type:"ADD_ADVETISEMENT",payload:(t=n==null?void 0:n.data)==null?void 0:t.response}),g.success("Advertisement uploaded successfully",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}catch(n){if(((a=n==null?void 0:n.response)==null?void 0:a.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}b(!1),g.error((v=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:v.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([])}}},[U,F]=l.useState(""),[P,N]=l.useState(""),[B,D]=l.useState(null),V=(t,a,o)=>{o.current?o.current.click():console.error("File input ref is null"),F(t),N(a)},H=async t=>{var n,L,$,M;const a=t.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(a.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const v=2*1024*1024;if(a.size>v){g.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const s=new FormData;s.append("id",P),s.append("advertisements",a),s.append("public_imgid",U),s.append("salonId",f);try{D(P);const c=await z.put("/api/advertisement/updateAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});F(""),N(""),D(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(n=c==null?void 0:c.data)==null?void 0:n.response})}catch(c){if(((L=c==null?void 0:c.response)==null?void 0:L.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}D(null),g.error((M=($=c==null?void 0:c.response)==null?void 0:$.data)==null?void 0:M.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[K,C]=l.useState(!1),J=async(t,a)=>{var v;if(window.confirm("Are you sure ?"))try{C(!0),await z.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:t,img_id:a}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:a})}catch(s){if(((v=s==null?void 0:s.response)==null?void 0:v.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},h=S(Q)==="On",O=t=>{const{active:a,over:o}=t;!o||a.id===o.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:a,over:o}})},R=l.useRef(new AbortController);l.useEffect(()=>{if(f&&r&&(r==null?void 0:r.length)>0){const t=new AbortController;return R.current=t,i(pe(f,r,t.signal)),()=>{R.current&&R.current.abort()}}},[r,f,i]);const W=X(T(fe),T(ue),T(ce,{coordinateGetter:ie}));return e.jsxs("div",{className:`${d.salonadv_container} ${h&&d.dark}`,children:[e.jsxs("div",{className:`${d.salonadv_header} ${h&&d.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(),children:[e.jsx("div",{children:e.jsx(Y,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:y,style:{display:"none"},multiple:!0,onChange:k,disabled:!!j})]}),e.jsxs("p",{children:[p==null?void 0:p.length," ","Files"]})]}),j?e.jsx("button",{children:e.jsx(ve,{color:"#fff"})}):e.jsxs("button",{onClick:m,disabled:!!j,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(Z,{})})]})]})]}),e.jsx("div",{className:d.salonadv_list_container,children:I?e.jsx("div",{className:d.salonadv_column,children:[...Array(6)].map((t,a)=>e.jsx(G,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:h?"var(--dark-loader-bg-color)":"var(--light-loader-bg-color)",highlightColor:h?"var(--dark-loader-highlight-color)":"var(--light-loader-highlight-color)"},a))}):E&&(r==null?void 0:r.length)>0?e.jsx(ee,{collisionDetection:te,onDragEnd:O,sensors:W,children:e.jsx("div",{className:`${d.salonadv_column} ${h&&d.dark}`,children:e.jsx(ae,{items:r.map(t=>t._id),strategy:ne,children:r.map(t=>e.jsx(se.Fragment,{children:e.jsx(Se,{id:t._id,url:t.url,public_id:t.public_id,editImageHandler:V,handleEditLoader:B,deleteHandler:J,deleteLoader:K,handleEditFileInputChange:H,darkmodeOn:h})},t._id))})})}):e.jsx("div",{className:`${d.salonadv_column_error} ${h&&d.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},Se=({id:u,url:f,public_id:y,editImageHandler:A,handleEditLoader:p,deleteHandler:_,deleteLoader:k,handleEditFileInputChange:i,darkmodeOn:x})=>{const{attributes:w,listeners:I,setNodeRef:E,transform:r,transition:j}=oe({id:u}),b=l.useRef(null);return e.jsxs("div",{className:`${d.salonadv_task} ${x&&d.dark}`,ref:E,...w,...I,style:{transition:j,transform:re.Transform.toString(r)},children:[p===u?e.jsx("div",{children:e.jsx(G,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:f,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(y,u,b),disabled:p===u,onPointerDown:m=>m.stopPropagation(),onTouchStart:m=>m.stopPropagation(),children:[e.jsx("div",{children:e.jsx(le,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:b,style:{display:"none"},onChange:i})]}),e.jsxs("button",{onClick:()=>_(y,u),disabled:k,onPointerDown:m=>m.stopPropagation(),onTouchStart:m=>m.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{De as default};
