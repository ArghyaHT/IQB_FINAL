import{dy as z,x as S,dz as N,dA as J,_ as x,dB as xe,dC as fe,dD as K,dE as je,dF as ye,dG as V,u as y,a as Se,r as d,d as Ce,b as ve,j as e,z as Ee,h as Ae,C as W,i as ke,S as Me,f as Re,R as Ne}from"./index-zklAvn-K.js";import{B as X}from"./ButtonLoader-DrEEcdA8.js";import{M as Y}from"./Modal-KFQkxZ6b.js";import"./index-DikGMDqK.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-C0jiAxVM.js";const Be="_customer_wrapper_i3cdi_1",we="_customer_search_i3cdi_28",$e="_customer_send_btn_i3cdi_64",Le="_customer_content_wrapper_i3cdi_101",Ie="_customer_content_body_i3cdi_112",ze="_customer_pagination_wrapper_i3cdi_214",Te="_mobile_customer_search_i3cdi_255",Oe="_modal_container_i3cdi_267",Ge="_modal_content_container_i3cdi_334",Ue="_barber_send_btn_i3cdi_409",Fe="_customer_content_body_error_i3cdi_443",t={customer_wrapper:Be,customer_search:we,customer_send_btn:$e,customer_content_wrapper:Le,customer_content_body:Ie,customer_pagination_wrapper:ze,mobile_customer_search:Te,modal_container:Oe,modal_content_container:Ge,barber_send_btn:Ue,customer_content_body_error:Fe},De=(b,o,c)=>async m=>{var p,h;try{m({type:z});const{data:i}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${b}&isApproved=${o}`,{signal:c});m({type:N,payload:i})}catch(i){if(((p=i==null?void 0:i.response)==null?void 0:p.status)===500){m({type:J,payload:"Something went wrong !"}),x.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}i.name!=="CanceledError"&&m({type:J,payload:(h=i==null?void 0:i.response)==null?void 0:h.data})}},He=(b,o,c,m)=>async p=>{var h,i,u,a;try{p({type:xe});const{data:l}=await S.post("/api/bulkMessageAndEmails/sendBulkEmails",b);p({type:fe,payload:l}),o(""),c(""),x.success(l==null?void 0:l.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),m(!1)}catch(l){if(((h=l==null?void 0:l.response)==null?void 0:h.status)===500){p({type:K,payload:"Something went wrong !"}),x.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}p({type:K,payload:(i=l==null?void 0:l.response)==null?void 0:i.data}),x.error((a=(u=l==null?void 0:l.response)==null?void 0:u.data)==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},Qe=(b,o,c)=>async m=>{var p,h,i,u;try{m({type:je});const{data:a}=await S.post("/api/bulkMessageAndEmails/sendBulkTextMessages",b);m({type:ye,payload:a}),o(""),x.success(a==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),c(!1)}catch(a){if(((p=a==null?void 0:a.response)==null?void 0:p.status)===500){m({type:V,payload:"Something went wrong !"}),x.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}m({type:V,payload:(h=a==null?void 0:a.response)==null?void 0:h.data}),x.error((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},Ze=()=>{const b=y(s=>s.BarberLoggedInMiddleware.barberSalonId),o=y(s=>s.BarberLoggedInMiddleware.entiredata),c=Se(),m=d.useRef(new AbortController);d.useEffect(()=>{var r;const s=new AbortController;return m.current=s,c(De(b,(r=o==null?void 0:o.user[0])==null?void 0:r.isApproved,s.signal)),()=>{m.current&&m.current.abort()}},[c,o]);const p=y(s=>s.barberGetAllCustomerList),{loading:h,resolve:i,getAllCustomers:u,currentPage:a,totalPages:l}=p,g=y(Ce)==="On",[B,Z]=d.useState(""),[P,T]=d.useState(!1),ee=async()=>{var s;T(!0);try{const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${b}&isApproved=${(s=o==null?void 0:o.user[0])==null?void 0:s.isApproved}&name=${B}`);c({type:N,payload:r})}catch(r){console.error("Error searching customers:",r)}finally{T(!1)}};d.useEffect(()=>{const s=setTimeout(()=>{ee()},300);return()=>clearTimeout(s)},[B]);const[C,w]=d.useState(1);d.useEffect(()=>{a&&w(a)},[a]);const[se,f]=d.useState(!1),[O,$]=d.useState({}),[v,E]=d.useState([]),[G,A]=d.useState([]),[L,k]=d.useState([]),te=async()=>{var s;if(C>1)try{c({type:z});const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${b}&isApproved=${(s=o==null?void 0:o.user[0])==null?void 0:s.isApproved}&page=${C-1}`);c({type:N,payload:r}),w(n=>n-1),f(!1)}catch(r){console.error("Error fetching customers:",r),f(!1)}},re=async()=>{var s;if(C<l)try{c({type:z});const{data:r}=await S.get(`/api/customers/getAllCustomersForBarber?salonId=${b}&isApproved=${(s=o==null?void 0:o.user[0])==null?void 0:s.isApproved}&page=${C+1}`);c({type:N,payload:r}),w(n=>n+1),f(!1)}catch(r){console.error("Error fetching customers:",r),f(!1)}},ae=s=>{const r=!O[s._id];$(n=>({...n,[s._id]:r})),r?(E(n=>[...n,s.email]),A(n=>[...n,+`${s==null?void 0:s.mobileCountryCode}${s==null?void 0:s.mobileNumber}`]),k(n=>[...n,s.name]),f(!1)):(E(n=>n.filter(j=>j!==s.email)),A(n=>n.filter(j=>j!==+`${s==null?void 0:s.mobileCountryCode}${s==null?void 0:s.mobileNumber}`)),k(n=>n.filter(j=>j!==s.name)),f(!1))},oe=s=>{f(r=>{if(r)E([]),A([]),k([]),$({});else{const n=u.map(_=>_.email),j=u.map(_=>+`${_==null?void 0:_.mobileCountryCode}${_==null?void 0:_.mobileNumber}`),be=u.map(_=>_.name),he=u.reduce((_,ge)=>(_[ge._id]=!0,_),{});E(n),A(j),k(be),$(he)}return!r})};ve();const[ne,M]=d.useState(!1),ie=()=>{v.length>0?M(!0):x.error("Atleast one customer needed",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[U,F]=d.useState(""),[D,I]=d.useState(""),le=()=>{c(He({subject:U,message:D,role:"Barber",recipientEmails:v},F,I,M))},de=y(s=>s.barberSendCustomerEmail),{loading:H}=de,[ce,R]=d.useState(!1),[Q,me]=d.useState(""),ue=()=>{G.length>0?R(!0):x.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},_e=()=>{c(Qe({smsBody:Q,numbers:G},I,R))},pe=y(s=>s.barberSendCustomerMessage),{loading:q}=pe;return e.jsxs("div",{className:`${t.customer_wrapper} ${g&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${g&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:B,onChange:s=>Z(s.target.value)}),e.jsx("div",{children:e.jsx(Ee,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${g&&t.dark}`,onClick:ie,title:"Email",children:e.jsx("div",{children:e.jsx(Ae,{})})}),e.jsx(Y,{open:ne,onClose:()=>M(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>M(!1),children:e.jsx(W,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:v==null?void 0:v.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:U,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:D,onChange:s=>I(s.target.value)})]}),H?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(X,{})}):e.jsx("button",{onClick:le,disabled:H,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${g&&t.dark}`,onClick:ue,title:"Message",children:e.jsx("div",{children:e.jsx(ke,{})})}),e.jsx(Y,{open:ce,onClose:()=>R(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>R(!1),children:e.jsx(W,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:L==null?void 0:L.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:Q,onChange:s=>me(s.target.value)})]}),q?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(X,{})}):e.jsx("button",{onClick:_e,disabled:q,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${g&&t.dark}`,children:h||P?e.jsx("div",{className:t.customer_content_body,children:e.jsx(Me,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:g?"var(--darkmode-loader-bg-color)":"var(--light-loader-bg-color)",highlightColor:g?"var(--darkmode-loader-highlight-color)":"var(--light-loader-highlight-color)"})}):i&&(u==null?void 0:u.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${g&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:oe,checked:se})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),u.map((s,r)=>e.jsxs("div",{style:{borderBottom:u.length-1===r&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:O[s._id]||!1,onChange:()=>ae(s)})}),e.jsx("p",{children:(s==null?void 0:s.name.length)>18?`${s.name.slice(0,18)}...`:s.name}),e.jsx("p",{children:(s==null?void 0:s.email.length)>18?`${s.email.slice(0,18)}...`:s.email}),e.jsx("p",{children:s==null?void 0:s.gender}),e.jsx("p",{children:s==null?void 0:s.mobileNumber})]},s._id))]}):e.jsx("div",{className:`${t.customer_content_body_error} ${g&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:t.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:te,children:e.jsx(Re,{})}),e.jsx("div",{onClick:re,disabled:C===l,children:e.jsx(Ne,{})})]})})]})};export{Ze as default};
