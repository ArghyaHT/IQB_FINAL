import{a7 as B,p as k,a8 as E,a9 as Q,_ as I,b as x,u as pe,r,d as be,j as e,aa as xe,f as ge,C as J,M as je,e as fe,R as Ce}from"./index-CIJl-UZQ.js";import{S as ye}from"./index-bWwoMs2U.js";import{d as ve,e as Se}from"./BarberAction-BIdIoazS.js";import{B as K}from"./ButtonLoader-Bl_AOGZC.js";import{M as V}from"./Modal-rrrW61NF.js";import"./index-RTiQy-ZE.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-CXs34_Mj.js";const ke="_customer_wrapper_14092_1",Ee="_customer_search_14092_28",Me="_customer_send_btn_14092_64",Ne="_customer_content_wrapper_14092_101",$e="_customer_content_body_14092_112",we="_customer_pagination_wrapper_14092_213",Le="_mobile_customer_search_14092_254",Ae="_modal_container_14092_266",Be="_modal_content_container_14092_333",Ie="_barber_send_btn_14092_408",Re="_customer_content_body_error_14092_442",s={customer_wrapper:ke,customer_search:Ee,customer_send_btn:Me,customer_content_wrapper:Ne,customer_content_body:$e,customer_pagination_wrapper:we,mobile_customer_search:Le,modal_container:Ae,modal_content_container:Be,barber_send_btn:Ie,customer_content_body_error:Re},Te=(h,n)=>async m=>{var g,j;try{m({type:B});const{data:o}=await k.get(`/api/customers/getAllCustomers?salonId=${h}`,{signal:n});m({type:E,payload:o})}catch(o){if(((g=o==null?void 0:o.response)==null?void 0:g.status)===500){m({type:Q,payload:"Something went wrong !"}),I.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}o.name!=="CanceledError"&&m({type:Q,payload:(j=o==null?void 0:o.response)==null?void 0:j.data})}},Qe=()=>{const h=x(t=>t.AdminLoggedInMiddleware.adminSalonId),n=pe(),m=r.useRef(new AbortController);r.useEffect(()=>{const t=new AbortController;return m.current=t,n(Te(h,t.signal)),()=>{m.current&&m.current.abort()}},[n]);const g=x(t=>t.adminGetAllCustomerList),{loading:j,resolve:o,getAllCustomers:l,currentPage:M,totalPages:R}=g,i=x(be)==="On",[N,W]=r.useState(""),[X,T]=r.useState(!1),G=async()=>{T(!0);try{const{data:t}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&name=${N}`);n({type:E,payload:t})}catch(t){console.error("Error searching customers:",t)}finally{T(!1)}};r.useEffect(()=>{const t=setTimeout(()=>{G()},300);return()=>clearTimeout(t)},[N]);const[Y,u]=r.useState(!1),[O,$]=r.useState({}),[p,f]=r.useState([]),[H,C]=r.useState([]),[w,y]=r.useState([]),[b,L]=r.useState(1);r.useEffect(()=>{M&&L(M)},[M]);const Z=async()=>{if(b>1)try{n({type:B});const{data:t}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${b-1}`);n({type:E,payload:t}),u(!1),L(c=>c-1)}catch(t){console.error("Error fetching customers:",t),u(!1)}},ee=async()=>{if(b<R)try{n({type:B});const{data:t}=await k.get(`/api/customers/getAllCustomers?salonId=${h}&page=${b+1}`);n({type:E,payload:t}),L(c=>c+1),u(!1)}catch(t){console.error("Error fetching customers:",t),u(!1)}},te=t=>{const c=!O[t._id];$(a=>({...a,[t._id]:c})),c?(f(a=>[...a,t.email]),C(a=>[...a,+`${t.mobileCountryCode}${t.mobileNumber}`]),y(a=>[...a,t.name]),u(!1)):(f(a=>a.filter(_=>_!==t.email)),C(a=>a.filter(_=>_!==+`${t.mobileCountryCode}${t.mobileNumber}`)),y(a=>a.filter(_=>_!==t.name)),u(!1))},se=t=>{u(c=>{if(c)f([]),C([]),y([]),$({});else{const a=l.map(d=>d.email),_=l.map(d=>+`${d.mobileCountryCode}${d.mobileNumber}`),ue=l.map(d=>d.name),_e=l.reduce((d,he)=>(d[he._id]=!0,d),{});f(a),C(_),y(ue),$(_e)}return!c})},[re,v]=r.useState(!1),ae=()=>{p.length>0?v(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[P,U]=r.useState(""),[z,A]=r.useState(""),ne=()=>{n(ve({subject:P,message:z,role:"Barber",recipientEmails:p},U,A,v))},oe=x(t=>t.adminSendBarberEmail),{loading:F}=oe,[le,S]=r.useState(!1),[q,ce]=r.useState(""),ie=()=>{H.length>0?S(!0):I.error("Please select a customer",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},de=()=>{n(Se({smsBody:q,numbers:H},A,S))},me=x(t=>t.adminSendBarberMessage),{loading:D}=me;return e.jsxs("div",{className:`${s.customer_wrapper} ${i&&s.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${s.customer_search} ${i&&s.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:N,onChange:t=>W(t.target.value)}),e.jsx("div",{onClick:G,children:e.jsx(xe,{})})]}),e.jsx("button",{className:`${s.customer_send_btn} ${i&&s.dark}`,onClick:ae,title:"Email",children:e.jsx("div",{children:e.jsx(ge,{})})}),e.jsx(V,{open:re,onClose:()=>v(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:s.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>v(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:s.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:p==null?void 0:p.map(t=>" "+t)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:P,onChange:t=>U(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:z,onChange:t=>A(t.target.value)})]}),F?e.jsx("button",{className:s.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:ne,disabled:F,className:s.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${s.customer_send_btn} ${i&&s.dark}`,onClick:ie,title:"Message",children:e.jsx("div",{children:e.jsx(je,{})})}),e.jsx(V,{open:le,onClose:()=>S(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:s.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>S(!1),children:e.jsx(J,{})})]}),e.jsxs("div",{className:s.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:w==null?void 0:w.map(t=>" "+t)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:q,onChange:t=>ce(t.target.value)})]}),D?e.jsx("button",{className:s.barber_send_btn,children:e.jsx(K,{})}):e.jsx("button",{onClick:de,disabled:D,className:s.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${s.customer_content_wrapper} ${i&&s.dark}`,children:j||X?e.jsx("div",{className:s.customer_content_body,children:e.jsx(ye,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:i?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:i?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"})}):o&&(l==null?void 0:l.length)>0?e.jsxs("div",{className:`${s.customer_content_body} ${i&&s.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:se,checked:Y})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),l==null?void 0:l.map((t,c)=>e.jsxs("div",{style:{borderBottom:l.length-1===c&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:O[t._id]||!1,onChange:()=>te(t)})}),e.jsx("p",{children:(t==null?void 0:t.name.length)>18?`${t.name.slice(0,18)}...`:t.name}),e.jsx("p",{children:(t==null?void 0:t.email.length)>18?`${t.email.slice(0,18)}...`:t.email}),e.jsx("p",{children:t==null?void 0:t.gender}),e.jsx("p",{children:t==null?void 0:t.mobileNumber})]},t._id))]}):e.jsx("div",{className:`${s.customer_content_body_error} ${i&&s.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:s.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:Z,children:e.jsx(fe,{})}),e.jsx("div",{onClick:ee,disabled:b===R,children:e.jsx(Ce,{})})]})})]})};export{Qe as default};
