import{u as S,r as l,a as q,d as Z,k as Q,l as R,j as e,F as X,U as Y,S as G,m as ee,o as te,p as ne,q as ae,Z as se,s as oe,t as re,v as le,w as de,_ as g,x as z,y as ie,K as ce,T as ue,P as fe}from"./index-zklAvn-K.js";import{g as pe,c as me}from"./DashboardAction-DYpfsFW3.js";import{B as ve}from"./ButtonLoader-DrEEcdA8.js";const ge="_salonadv_container_1lfv1_1",he="_salonadv_header_1lfv1_14",_e="_salonadv_adv_list_container_1lfv1_145",be="_salonadv_column_1lfv1_150",ye="_salonadv_task_1lfv1_160",xe="_salonadv_column_error_1lfv1_293",je="_dark_1lfv1_306",d={salonadv_container:ge,salonadv_header:he,salonadv_adv_list_container:_e,salonadv_column:be,salonadv_task:ye,salonadv_column_error:xe,dark:je},Ee=()=>{const u=S(t=>t.AdminLoggedInMiddleware.entiredata.user[0]),f=S(t=>t.AdminLoggedInMiddleware.adminSalonId),y=l.useRef(null),A=()=>{y.current.click()},[m,_]=l.useState([]),k=async t=>{const n=t.target.files,o=["image/jpeg","image/webp","image/png"];if(Array.from(n).filter(a=>!o.includes(a.type)).length>0){g.error("Please upload only valid image files (JPEG, WebP, PNG).",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([]);return}const s=Array.from(n).filter(a=>o.includes(a.type));_(s)},i=q(),x=l.useRef(new AbortController);l.useEffect(()=>{const t=new AbortController;return x.current=t,i(pe(f,t.signal)),()=>{x.current&&x.current.abort()}},[f,i]);const w=S(t=>t.getAllAdvertisement),{loading:I,resolve:E,advertisements:r}=w,[j,b]=l.useState(!1),p=async()=>{var t,n,o,v;if(m.length>0){const s=new FormData;s.append("salonId",f);for(const a of m)s.append("advertisements",a);try{b(!0);const a=await z.post("/api/advertisement/addAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});b(!1),_([]),i({type:"ADD_ADVETISEMENT",payload:(t=a==null?void 0:a.data)==null?void 0:t.response}),g.success("Advertisement uploaded successfully",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}catch(a){if(((n=a==null?void 0:a.response)==null?void 0:n.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}b(!1),g.error((v=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:v.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),_([])}}},[U,F]=l.useState(""),[P,N]=l.useState(""),[B,D]=l.useState(null),V=(t,n,o)=>{o.current?o.current.click():console.error("File input ref is null"),F(t),N(n)},H=async t=>{var a,L,$,M;const n=t.target.files[0];if(!["image/jpeg","image/webp","image/png"].includes(n.type)){alert("Please upload a valid image file (JPEG, WebP, PNG).");return}const v=2*1024*1024;if(n.size>v){g.error("File size must be lower than 2mb",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}const s=new FormData;s.append("id",P),s.append("advertisements",n),s.append("public_imgid",U),s.append("salonId",f);try{D(P);const c=await z.put("/api/advertisement/updateAdvertisements",s,{headers:{"Content-Type":"multipart/form-data"}});F(""),N(""),D(null),i({type:"AFTER_UPDATE_ADVERTISEMENTLIST",payload:(a=c==null?void 0:c.data)==null?void 0:a.response})}catch(c){if(((L=c==null?void 0:c.response)==null?void 0:L.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}D(null),g.error((M=($=c==null?void 0:c.response)==null?void 0:$.data)==null?void 0:M.message,{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},[K,C]=l.useState(!1),J=async(t,n)=>{var v;if(window.confirm("Are you sure ?"))try{C(!0),await z.delete("/api/advertisement/deleteAdvertisements",{data:{public_id:t,img_id:n}}),C(!1),i({type:"FILTER_ADVERTISEMENTLIST",payload:n})}catch(s){if(((v=s==null?void 0:s.response)==null?void 0:v.status)===500){g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--font-size-2)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}C(!1)}},h=S(Z)==="On",O=t=>{const{active:n,over:o}=t;!o||n.id===o.id||i({type:"DRAG_END_ADVERTISEMENTLIST",payload:{active:n,over:o}})},T=l.useRef(new AbortController);l.useEffect(()=>{if(f&&r&&(r==null?void 0:r.length)>0){const t=new AbortController;return T.current=t,i(me(f,r,t.signal)),()=>{T.current&&T.current.abort()}}},[r,f,i]);const W=Q(R(fe),R(ue),R(ce,{coordinateGetter:ie}));return e.jsxs("div",{className:`${d.salonadv_container} ${h&&d.dark}`,children:[e.jsxs("div",{className:`${d.salonadv_header} ${h&&d.dark}`,children:[e.jsx("p",{children:"Advertisements with Drag-and-Drop"}),(u==null?void 0:u.salonId)!==0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(),children:[e.jsx("div",{children:e.jsx(X,{})}),e.jsx("p",{children:"Choose Files"}),e.jsx("input",{type:"file",ref:y,style:{display:"none"},multiple:!0,onChange:k,disabled:!!j})]}),e.jsxs("p",{children:[m==null?void 0:m.length," ","Files"]})]}),j?e.jsx("button",{children:e.jsx(ve,{color:"#fff"})}):e.jsxs("button",{onClick:p,disabled:!!j,children:[e.jsx("p",{children:"Upload"}),e.jsx("div",{children:e.jsx(Y,{})})]})]})]}),e.jsx("div",{className:d.salonadv_list_container,children:I?e.jsx("div",{className:d.salonadv_column,children:[...Array(6)].map((t,n)=>e.jsx(G,{count:1,width:"95%",height:"30rem",style:{borderRadius:"0.6rem"},baseColor:h?"var(--dark-loader-bg-color)":"var(--light-loader-bg-color)",highlightColor:h?"var(--dark-loader-highlight-color)":"var(--light-loader-highlight-color)"},n))}):E&&(r==null?void 0:r.length)>0?e.jsx(ee,{collisionDetection:te,onDragEnd:O,sensors:W,children:e.jsx("div",{className:`${d.salonadv_column} ${h&&d.dark}`,children:e.jsx(ne,{items:r.map(t=>t._id),strategy:ae,children:r.map(t=>e.jsx(se.Fragment,{children:e.jsx(Se,{id:t._id,url:t.url,public_id:t.public_id,editImageHandler:V,handleEditLoader:B,deleteHandler:J,deleteLoader:K,handleEditFileInputChange:H,darkmodeOn:h})},t._id))})})}):e.jsx("div",{className:`${d.salonadv_column_error} ${h&&d.dark}`,children:e.jsx("p",{children:"No Advertisment Avaialble"})})})]})},Se=({id:u,url:f,public_id:y,editImageHandler:A,handleEditLoader:m,deleteHandler:_,deleteLoader:k,handleEditFileInputChange:i,darkmodeOn:x})=>{const{attributes:w,listeners:I,setNodeRef:E,transform:r,transition:j}=oe({id:u}),b=l.useRef(null);return e.jsxs("div",{className:`${d.salonadv_task} ${x&&d.dark}`,ref:E,...w,...I,style:{transition:j,transform:re.Transform.toString(r)},children:[m===u?e.jsx("div",{children:e.jsx(G,{width:"100%",height:"100%"})}):e.jsx("div",{children:e.jsx("img",{src:f,alt:""})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>A(y,u,b),disabled:m===u,onPointerDown:p=>p.stopPropagation(),onTouchStart:p=>p.stopPropagation(),children:[e.jsx("div",{children:e.jsx(le,{})}),e.jsx("p",{children:"Edit"}),e.jsx("input",{type:"file",ref:b,style:{display:"none"},onChange:i})]}),e.jsxs("button",{onClick:()=>_(y,u),disabled:k,onPointerDown:p=>p.stopPropagation(),onTouchStart:p=>p.stopPropagation(),children:[e.jsx("div",{children:e.jsx(de,{})}),e.jsx("p",{children:"Delete"})]})]})]})};export{Ee as default};
