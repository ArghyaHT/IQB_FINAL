import{dn as T,p as S,dp as A,dq as P,_ as g,dr as fe,ds as je,dt as J,du as xe,dv as ye,dw as K,b as y,u as Se,r as n,d as Ce,a as ve,j as e,aa as Ee,f as ke,C as V,M as we,e as Me,R as Re}from"./index-DswqzyJH.js";import{S as Ae}from"./index-CoQheMi3.js";import{B as W}from"./ButtonLoader-DEiwYJeU.js";import{M as X}from"./Modal-Bvpc9ZkB.js";import"./index-pXkuTEkE.js";import"./clsx-B-dksMZM.js";import"./getReactElementRef-DGXGC95N.js";const Ne="_customer_wrapper_1rw7j_1",Be="_customer_search_1rw7j_28",Le="_customer_send_btn_1rw7j_64",$e="_customer_content_wrapper_1rw7j_101",Ie="_customer_content_body_1rw7j_112",Te="_customer_pagination_wrapper_1rw7j_203",Oe="_mobile_customer_search_1rw7j_244",Ge="_modal_container_1rw7j_256",Ue="_modal_content_container_1rw7j_323",ze="_barber_send_btn_1rw7j_398",Fe="_customer_content_body_error_1rw7j_432",t={customer_wrapper:Ne,customer_search:Be,customer_send_btn:Le,customer_content_wrapper:$e,customer_content_body:Ie,customer_pagination_wrapper:Te,mobile_customer_search:Oe,modal_container:Ge,modal_content_container:Ue,barber_send_btn:ze,customer_content_body_error:Fe},De=(b,p,l)=>async d=>{var u,m,_,a;try{d({type:T});const{data:r}=await S.get(`/api/customer/getAllCustomersForBarber?salonId=${b}&isApproved=${p}`,{signal:l});d({type:A,payload:r})}catch(r){if(((u=r==null?void 0:r.response)==null?void 0:u.status)===500){d({type:P,payload:"Something went wrong !"}),g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}r.name!=="CanceledError"&&(d({type:P,payload:(m=r==null?void 0:r.response)==null?void 0:m.data}),g.error((a=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}))}},He=(b,p,l,d)=>async u=>{var m,_,a,r;try{u({type:fe});const{data:o}=await S.post("/api/bulkMessageAndEmails/sendBulkEmails",b);u({type:je,payload:o}),p(""),l(""),g.success(o==null?void 0:o.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),d(!1)}catch(o){if(((m=o==null?void 0:o.response)==null?void 0:m.status)===500){u({type:J,payload:"Something went wrong !"}),g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}u({type:J,payload:(_=o==null?void 0:o.response)==null?void 0:_.data}),g.error((r=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:r.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},qe=(b,p,l)=>async d=>{var u,m,_,a;try{d({type:xe});const{data:r}=await S.post("/api/bulkMessageAndEmails/sendBulkTextMessages",b);d({type:ye,payload:r}),p(""),g.success(r==null?void 0:r.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}}),l(!1)}catch(r){if(((u=r==null?void 0:r.response)==null?void 0:u.status)===500){d({type:K,payload:"Something went wrong !"}),g.error("Something went wrong !",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}});return}d({type:K,payload:(m=r==null?void 0:r.response)==null?void 0:m.data}),g.error((a=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:a.message,{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})}},Ze=()=>{const b=y(s=>s.BarberLoggedInMiddleware.barberSalonId),p=y(s=>s.BarberLoggedInMiddleware.entiredata),l=Se(),d=n.useRef(new AbortController);n.useEffect(()=>{var i;const s=new AbortController;return d.current=s,l(De(b,(i=p==null?void 0:p.user[0])==null?void 0:i.isApproved,s.signal)),()=>{d.current&&d.current.abort()}},[l,p]);const u=y(s=>s.barberGetAllCustomerList),{loading:m,resolve:_,getAllCustomers:a,currentPage:r,totalPages:o}=u,h=y(Ce)==="On",[N,Y]=n.useState(""),[Z,O]=n.useState(!1),ee=async()=>{O(!0);try{const{data:s}=await S.get(`/api/customer/getAllCustomersForBarber?salonId=${b}&name=${N}`);l({type:A,payload:s})}catch(s){console.error("Error searching customers:",s)}finally{O(!1)}};n.useEffect(()=>{const s=setTimeout(()=>{ee()},300);return()=>clearTimeout(s)},[N]);const[C,B]=n.useState(1);n.useEffect(()=>{r&&B(r)},[r]);const[se,j]=n.useState(!1),[G,L]=n.useState({}),[v,E]=n.useState([]),[U,k]=n.useState([]),[$,w]=n.useState([]),re=async()=>{if(C>1)try{l({type:T});const{data:s}=await S.get(`/api/customer/getAllCustomersForBarber?salonId=${b}&page=${C-1}`);l({type:A,payload:s}),B(i=>i-1),j(!1)}catch(s){console.error("Error fetching customers:",s),j(!1)}},te=async()=>{if(C<o)try{l({type:T});const{data:s}=await S.get(`/api/customer/getAllCustomersForBarber?salonId=${b}&page=${C+1}`);l({type:A,payload:s}),B(i=>i+1),j(!1)}catch(s){console.error("Error fetching customers:",s),j(!1)}},ae=s=>{const i=!G[s._id];L(c=>({...c,[s._id]:i})),i?(E(c=>[...c,s.email]),k(c=>[...c,+`${s.mobileCountryCode}${s.mobileNumber}`]),w(c=>[...c,s.name]),j(!1)):(E(c=>c.filter(x=>x!==s.email)),k(c=>c.filter(x=>x!==+`${s.mobileCountryCode}${s.mobileNumber}`)),w(c=>c.filter(x=>x!==s.name)),j(!1))},oe=s=>{j(i=>{if(i)E([]),k([]),w([]),L({});else{const c=a.map(f=>f.email),x=a.map(f=>+`${f.mobileCountryCode}${f.mobileNumber}`),pe=a.map(f=>f.name),he=a.reduce((f,ge)=>(f[ge._id]=!0,f),{});E(c),k(x),w(pe),L(he)}return!i})};ve();const[ne,M]=n.useState(!1),le=()=>{v.length>0?M(!0):g.error("Atleast one customer needed",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},[z,F]=n.useState(""),[D,I]=n.useState(""),de=()=>{l(He({subject:z,message:D,role:"Barber",recipientEmails:v},F,I,M))},ce=y(s=>s.barberSendCustomerEmail),{loading:H}=ce,[ie,R]=n.useState(!1),[q,me]=n.useState(""),ue=()=>{U.length>0?R(!0):g.error("Atleast one customer needed",{duration:3e3,style:{fontSize:"var(--list-modal-header-normal-font)",borderRadius:"0.3rem",background:"#333",color:"#fff"}})},_e=()=>{const s={smsBody:q,numbers:U};console.log(s),l(qe(s,I,R))},be=y(s=>s.barberSendCustomerMessage),{loading:Q}=be;return e.jsxs("div",{className:`${t.customer_wrapper} ${h&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Customer List"}),e.jsxs("div",{children:[e.jsxs("div",{className:`${t.customer_search} ${h&&t.dark}`,children:[e.jsx("input",{type:"text",placeholder:"Search Customer",value:N,onChange:s=>Y(s.target.value)}),e.jsx("div",{children:e.jsx(Ee,{})})]}),e.jsx("button",{className:`${t.customer_send_btn} ${h&&t.dark}`,onClick:le,children:e.jsx("div",{children:e.jsx(ke,{})})}),e.jsx(X,{open:ne,onClose:()=>M(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Email"}),e.jsx("button",{onClick:()=>M(!1),children:e.jsx(V,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"support@iqueuebarbers.com",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:v==null?void 0:v.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Subject"}),e.jsx("input",{type:"text",placeholder:"Enter Subject",value:z,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:D,onChange:s=>I(s.target.value)})]}),H?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(W,{})}):e.jsx("button",{onClick:de,disabled:H,className:t.barber_send_btn,children:"Send"})]})]})}),e.jsx("button",{className:`${t.customer_send_btn} ${h&&t.dark}`,onClick:ue,children:e.jsx("div",{children:e.jsx(we,{})})}),e.jsx(X,{open:ie,onClose:()=>R(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs("div",{className:t.modal_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"Send Message"}),e.jsx("button",{onClick:()=>R(!1),children:e.jsx(V,{})})]}),e.jsxs("div",{className:t.modal_content_container,children:[e.jsxs("div",{children:[e.jsx("p",{children:"From"}),e.jsx("input",{type:"text",value:"iqueuebarbers",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("p",{children:"To"}),e.jsx("input",{type:"text",value:$==null?void 0:$.map(s=>" "+s)})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Message"}),e.jsx("textarea",{type:"text",placeholder:"Enter Message",value:q,onChange:s=>me(s.target.value)})]}),Q?e.jsx("button",{className:t.barber_send_btn,children:e.jsx(W,{})}):e.jsx("button",{onClick:_e,disabled:Q,className:t.barber_send_btn,children:"Send"})]})]})})]})]}),e.jsx("div",{className:`${t.customer_content_wrapper} ${h&&t.dark}`,children:m||Z?e.jsx("div",{className:t.customer_content_body,children:e.jsx(Ae,{count:6,height:"6rem",style:{marginBottom:"1rem"},baseColor:h?"var(--darkmode-loader-bg-color)":"var(--lightmode-loader-bg-color)",highlightColor:h?"var(--darkmode-loader-highlight-color)":"var(--lightmode-loader-highlight-color)"})}):!m&&_&&(a==null?void 0:a.length)>0?e.jsxs("div",{className:`${t.customer_content_body} ${h&&t.dark}`,children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",onChange:oe,checked:se})}),e.jsx("p",{children:"Name"}),e.jsx("p",{children:"Email"}),e.jsx("p",{children:"Gender"}),e.jsx("p",{children:"Mobile No."})]}),a.map((s,i)=>e.jsxs("div",{style:{borderBottom:a.length-1===i&&"none"},children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:G[s._id]||!1,onChange:()=>ae(s)})}),e.jsx("p",{children:s.name}),e.jsx("p",{children:s.email}),e.jsx("p",{children:s.gender}),e.jsx("p",{children:s.mobileNumber})]},s._id))]}):!m&&_&&(a==null?void 0:a.length)===0?e.jsx("div",{className:`${t.customer_content_body_error} ${h&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})}):!m&&!_&&e.jsx("div",{className:`${t.customer_content_body_error} ${h&&t.dark}`,children:e.jsx("p",{children:"Customers not available"})})}),e.jsx("div",{className:t.customer_pagination_wrapper,children:e.jsxs("div",{children:[e.jsx("div",{onClick:re,children:e.jsx(Me,{})}),e.jsx("div",{onClick:te,disabled:C===o,children:e.jsx(Re,{})})]})})]})};export{Ze as default};
